function formatearNumero(num) {
  return num.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function calcular() {
  // Leer valores del formulario
  const asesoramiento = parseFloat(document.getElementById('asesoramiento').value.replace(/\./g, '').replace(',', '.'));
  const rto = parseFloat(document.getElementById('rto').value.replace(/\./g, '').replace(',', '.'));
  const margen = parseFloat(document.getElementById('margen').value.replace(/\./g, '').replace(',', '.'));
 
  const operativo = document.getElementById('operativo').value;
  const saldos = document.getElementById('saldos').value;
  const permanencia = document.getElementById('permanencia').value;

  const resultado = document.getElementById('resultado');
  resultado.textContent = ""; // Limpiar antes

  // Validaciones
  if (isNaN(asesoramiento) || isNaN(rto) || isNaN(margen)) {
    resultado.textContent = "❌ Error: Introduce valores numéricos válidos.";
    return;
  }

  // Cálculo
  const saldoCartera = asesoramiento + rto;

  let criteriosCumplidos = 0;
  if (operativo === 'Sí') criteriosCumplidos++;
  if (saldos === 'Sí') criteriosCumplidos++;
  if (permanencia === 'Sí') criteriosCumplidos++;

  const porcentajeAdicional = {0: 0.00, 1: 0.001, 2: 0.004, 3: 0.006}[criteriosCumplidos];

  const cuantitativo = (asesoramiento * 0.0030) + (rto * 0.0020) + (asesoramiento * porcentajeAdicional);
  const cualitativoMax = (cuantitativo * 30) / 70;
  const cualitativo = cualitativoMax * (criteriosCumplidos / 3);

  const comisionBruta = cuantitativo + cualitativo;
  const comisionMaxima = saldoCartera * (margen / 100) * 0.75;
  const comisionFinal = Math.min(comisionBruta, comisionMaxima);

  // Mostrar resultado
  resultado.textContent =
    "\\nComisión por Criterios Cuantitativos: " + formatearNumero(cuantitativo) + " €" +
    "\\nComisión por Criterios Cualitativos: " + formatearNumero(cualitativo) + " €" +
    "\\nComisión Total antes de ajuste: " + formatearNumero(comisionBruta) + " €" +
    "\\nComisión Total FINAL (ajustada a máximo 75% margen): " + formatearNumero(comisionFinal) + " €";
}
